# 테스트/배포 전략 최종 설계서

> **작성일**: 2024-12-31
> **기반**: 사용자 요구사항 답변

---

## 📋 요구사항 정리

### 답변 요약
```
1. 테스트 계정: 없음 (실제 계정만 사용)
2. 테스트 데이터: 과거 실제 데이터 복사
3. F8 저장 테스트: 1개 데이터만 실제 저장
4. 모드 전환: 실행 스크립트 2개 (start_test.bat, start_prod.bat)
5. 안전 장치: 불필요
6. 배포 방식: .zip 압축 파일
7. 설정 입력: config.json 수동 수정
8. 테스트 기간: 1일
9. 배포 전략: 즉시 완전 자동화
10. 모니터링: 이메일
11. 데이터 검증: 안 함
```

### ⚠️ 리스크 인식
```
HIGH RISK 요소:
- 실제 계정으로 테스트
- 1일만 테스트 후 배포
- 완전 자동화 즉시 적용
- 데이터 검증 없음

→ 신중한 테스트 절차 필수!
→ 롤백 계획 필수!
```

---

## 🏗️ 시스템 구조

### 디렉토리 구조
```
Account_Automation/
│
├── 📁 테스트 PC용
│   ├── main.py
│   ├── requirements.txt
│   ├── config.json (mode: test)
│   ├── start_test.bat ← 테스트 모드 실행
│   ├── install.bat
│   ├── create_test_data.py ← 테스트 데이터 생성기
│   └── src/ (소스 코드)
│
├── 📁 배포 패키지 (실제 PC용)
│   └── Account_Automation_v1.0.zip
│       ├── main.py
│       ├── requirements.txt
│       ├── config.example.json
│       ├── install_production.bat ← 실제 PC용 설치
│       ├── start_prod.bat ← 실제 모드 실행
│       ├── stop.bat
│       ├── src/
│       └── docs/
│           ├── 설치_가이드.pdf
│           ├── 사용_매뉴얼.pdf
│           └── 긴급_대응_가이드.pdf
│
└── 📁 공통
    ├── logs/
    ├── sessions/
    ├── reports/
    ├── control/
    └── data/
```

---

## 🧪 테스트 PC 설정

### config.json (테스트 모드)
```json
{
  "mode": "test",
  
  "credentials": {
    "company_code": "650217",
    "username": "zartkang",
    "password": "your_password_here"
  },
  
  "test_settings": {
    "use_test_data": true,
    "test_data_source": "past_real_data",
    "test_data_date": "2024-12-01",
    "single_record_save_test": true,
    "max_test_records": 1
  },
  
  "browser": {
    "headless": false,
    "slow_mo": 500,
    "timeout": 30000
  },
  
  "schedule": {
    "enabled": false,
    "run_once": true
  },
  
  "monitoring": {
    "log_level": "DEBUG",
    "screenshot_on_error": true,
    "screenshot_every_step": true
  },
  
  "notification": {
    "email": {
      "enabled": true,
      "recipient": "zartkang@gmail.com",
      "send_on_error": true,
      "send_daily_summary": false,
      "send_on_test_complete": true
    }
  }
}
```

### start_test.bat
```batch
@echo off
REM ========================================
REM Account Automation - 테스트 모드
REM ========================================

cd /d %~dp0

echo.
echo ========================================
echo   Account Automation 테스트 모드
echo ========================================
echo.
echo [주의] 테스트 모드로 실행합니다.
echo - 브라우저 화면이 보입니다
echo - 과거 데이터로 테스트합니다
echo - 1개 데이터만 저장 테스트합니다
echo.

REM config.json 확인
findstr /C:"\"mode\": \"test\"" config.json >nul
if %ERRORLEVEL% NEQ 0 (
    echo [오류] config.json의 mode가 test가 아닙니다!
    echo 설정을 확인해주세요.
    pause
    exit /b 1
)

REM Python 가상환경 활성화
if exist venv\Scripts\activate.bat (
    call venv\Scripts\activate.bat
)

REM 프로그램 실행
echo 테스트 시작...
echo.
python main.py --mode test

echo.
echo ========================================
echo 테스트 완료!
echo ========================================
echo.
echo 로그 확인: logs\automation_*.log
echo 리포트 확인: reports\latest.html
echo.
pause
```

### create_test_data.py
```python
"""
과거 실제 데이터를 복사하여 테스트 데이터 생성
"""

import json
from datetime import datetime, timedelta

class TestDataCreator:
    """테스트 데이터 생성기"""
    
    def __init__(self, config_file='config.json'):
        with open(config_file, 'r', encoding='utf-8') as f:
            self.config = json.load(f)
    
    def create_from_past_data(self, past_date='2024-12-01'):
        """
        과거 데이터 복사
        
        실제 구현:
        1. 이카운트에서 과거 날짜 데이터 조회
        2. 1개만 추출
        3. 날짜를 오늘로 변경
        4. 금액/이름은 그대로 (실제 데이터 형식 유지)
        5. 테스트용으로 표시 (예: 비고란에 "[TEST]")
        """
        print(f"과거 데이터 조회 중: {past_date}")
        
        # 여기서 실제 이카운트 접속하여 데이터 가져오기
        # (main.py의 extract 로직 재사용)
        
        test_record = {
            "date": datetime.now().strftime("%Y-%m-%d"),
            "amount": "50000",  # 과거 데이터에서 복사
            "account": "테스트계정",  # 과거 데이터에서 복사
            "note": "[TEST] 테스트 데이터",
            "original_date": past_date
        }
        
        return test_record
    
    def save_test_data(self, test_record):
        """테스트 데이터 저장"""
        with open('data/test_record.json', 'w', encoding='utf-8') as f:
            json.dump(test_record, f, ensure_ascii=False, indent=2)
        
        print("테스트 데이터 생성 완료!")
        print(json.dumps(test_record, ensure_ascii=False, indent=2))

if __name__ == '__main__':
    creator = TestDataCreator()
    test_record = creator.create_from_past_data('2024-12-01')
    creator.save_test_data(test_record)
```

---

## 🚀 실제 PC 설정

### config.example.json (실제 모드 템플릿)
```json
{
  "mode": "production",
  
  "credentials": {
    "company_code": "650217",
    "username": "zartkang",
    "password": "여기에_실제_비밀번호_입력"
  },
  
  "test_settings": {
    "use_test_data": false,
    "single_record_save_test": false
  },
  
  "browser": {
    "headless": true,
    "slow_mo": 0,
    "timeout": 30000
  },
  
  "schedule": {
    "enabled": true,
    "interval_minutes": 30,
    "work_hours": {
      "start": "06:00",
      "end": "18:00"
    },
    "work_days": {
      "monday": {"enabled": true, "hours": "06:00-18:00"},
      "tuesday": {"enabled": true, "hours": "06:00-18:00"},
      "wednesday": {"enabled": true, "hours": "06:00-18:00"},
      "thursday": {"enabled": true, "hours": "06:00-18:00"},
      "friday": {"enabled": true, "hours": "06:00-18:00"},
      "saturday": {"enabled": true, "hours": "06:00-14:00"},
      "sunday": {"enabled": false}
    },
    "exclude_holidays": true
  },
  
  "monitoring": {
    "log_level": "INFO",
    "log_retention_days": 7,
    "screenshot_on_error": true,
    "screenshot_every_step": false
  },
  
  "notification": {
    "email": {
      "enabled": true,
      "smtp_server": "smtp.gmail.com",
      "smtp_port": 587,
      "sender": "your-gmail@gmail.com",
      "sender_password": "여기에_Gmail_앱_비밀번호_입력",
      "recipient": "zartkang@gmail.com",
      "send_on_error": true,
      "send_daily_summary": true,
      "summary_time": "18:00"
    }
  }
}
```

### install_production.bat
```batch
@echo off
REM ========================================
REM Account Automation 설치 (실제 PC용)
REM ========================================

echo.
echo ========================================
echo   Account Automation 설치
echo ========================================
echo.
echo 이 프로그램은 이카운트 데이터를 자동으로
echo 처리하는 프로그램입니다.
echo.
echo [중요] 실제 PC에 설치하는 것입니다!
echo.
pause

cd /d %~dp0

REM Python 설치 확인
python --version >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo [오류] Python이 설치되어 있지 않습니다!
    echo.
    echo Python 3.8 이상을 먼저 설치해주세요:
    echo https://www.python.org/downloads/
    echo.
    pause
    exit /b 1
)

echo [1/5] Python 버전 확인 완료
python --version

REM 가상환경 생성 (선택)
echo.
echo [2/5] 가상환경 생성 중...
python -m venv venv
call venv\Scripts\activate.bat

REM 의존성 설치
echo.
echo [3/5] 필요한 패키지 설치 중...
pip install -r requirements.txt

REM Playwright 설치
echo.
echo [4/5] Playwright 브라우저 설치 중...
playwright install chromium

REM 디렉토리 생성
echo.
echo [5/5] 디렉토리 구조 생성 중...
if not exist logs mkdir logs
if not exist sessions mkdir sessions
if not exist reports mkdir reports
if not exist control mkdir control
if not exist data mkdir data

REM config.json 생성
if not exist config.json (
    echo.
    echo config.json 파일 생성 중...
    copy config.example.json config.json
    
    echo.
    echo ========================================
    echo   설정 파일 수정 필요!
    echo ========================================
    echo.
    echo config.json 파일을 열어서 다음을 입력하세요:
    echo.
    echo 1. credentials.password (이카운트 비밀번호)
    echo 2. notification.email.sender (Gmail 주소)
    echo 3. notification.email.sender_password (Gmail 앱 비밀번호)
    echo.
    echo 수정 후 start_prod.bat을 실행하세요.
    echo.
)

REM Windows 시작 프로그램 등록 (선택)
echo.
set /p AUTOSTART="Windows 시작 시 자동 실행하시겠습니까? (y/n): "
if /i "%AUTOSTART%"=="y" (
    echo 자동 시작 설정 중...
    
    set STARTUP_FOLDER=%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup
    set CURRENT_DIR=%~dp0
    
    powershell -Command "$WshShell = New-Object -ComObject WScript.Shell; $Shortcut = $WshShell.CreateShortcut('%STARTUP_FOLDER%\Account_Automation.lnk'); $Shortcut.TargetPath = '%CURRENT_DIR%start_prod.bat'; $Shortcut.WorkingDirectory = '%CURRENT_DIR%'; $Shortcut.WindowStyle = 7; $Shortcut.Save()"
    
    echo 자동 시작 설정 완료!
)

echo.
echo ========================================
echo   설치 완료!
echo ========================================
echo.
echo 다음 단계:
echo 1. config.json 파일 수정 (비밀번호 등)
echo 2. start_prod.bat 실행하여 프로그램 시작
echo.
pause
```

### start_prod.bat
```batch
@echo off
REM ========================================
REM Account Automation - 실제 모드
REM ========================================

cd /d %~dp0

echo.
echo ========================================
echo   Account Automation 실제 모드
echo ========================================
echo.
echo [경고] 실제 데이터를 처리합니다!
echo.
echo - 백그라운드에서 실행됩니다
echo - 30분마다 자동 실행됩니다
echo - 이카운트에 실제 데이터를 업로드합니다
echo.

REM config.json 확인
if not exist config.json (
    echo [오류] config.json 파일이 없습니다!
    echo install_production.bat을 먼저 실행하세요.
    pause
    exit /b 1
)

findstr /C:"\"mode\": \"production\"" config.json >nul
if %ERRORLEVEL% NEQ 0 (
    echo [오류] config.json의 mode가 production이 아닙니다!
    echo 설정을 확인해주세요.
    pause
    exit /b 1
)

REM 중복 실행 확인
tasklist /FI "WINDOWTITLE eq Account_Automation*" | find "python.exe" >nul
if %ERRORLEVEL% == 0 (
    echo [경고] 이미 실행 중입니다.
    pause
    exit /b 1
)

REM Python 가상환경 활성화
if exist venv\Scripts\activate.bat (
    call venv\Scripts\activate.bat
)

REM 프로그램 실행 (백그라운드)
echo 프로그램 시작 중...
start "Account_Automation" /MIN pythonw main.py --mode production

echo.
echo ========================================
echo 프로그램이 백그라운드에서 시작되었습니다!
echo ========================================
echo.
echo 상태 확인: control\status.json
echo 로그 확인: logs\automation_*.log
echo 리포트 확인: reports\latest.html
echo.
echo 중지하려면: stop.bat 실행
echo.
pause
```

---

## 📦 배포 패키지 제작

### 패키지 구조
```
Account_Automation_v1.0.zip
│
├── README.txt                    # 간단 설명
├── install_production.bat        # 설치 스크립트
├── start_prod.bat               # 실행 스크립트
├── stop.bat                     # 중지 스크립트
├── config.example.json          # 설정 템플릿
├── requirements.txt             # 의존성
├── main.py                      # 메인 프로그램
│
├── src/                         # 소스 코드
│   ├── __init__.py
│   ├── config/
│   ├── core/
│   ├── ecount/
│   ├── monitor/
│   └── utils/
│
├── data/                        # 데이터 디렉토리
│   └── holidays.json            # 공휴일 목록
│
└── docs/                        # 문서
    ├── 설치_가이드.pdf
    ├── 사용_매뉴얼.pdf
    ├── 트러블슈팅.pdf
    └── 긴급_대응_가이드.pdf
```

### README.txt
```
========================================
  Account Automation v1.0
========================================

이카운트 결제내역을 자동으로 입금보고서에
업로드하는 프로그램입니다.

========================================
  빠른 시작
========================================

1. 압축 해제
   → 원하는 폴더에 압축을 풉니다
   → 예: C:\Account_Automation

2. 설치
   → install_production.bat 실행
   → Python 및 필요한 패키지 자동 설치

3. 설정
   → config.json 파일을 메모장으로 열기
   → 비밀번호 입력
   → Gmail 설정 입력

4. 실행
   → start_prod.bat 실행
   → 백그라운드에서 자동 실행 시작

5. 중지
   → stop.bat 실행

========================================
  문의
========================================

문제 발생 시:
1. logs\automation_YYYYMMDD.log 확인
2. docs\트러블슈팅.pdf 참고
3. zartkang@gmail.com 문의

========================================
```

### 패키지 제작 스크립트 (create_package.bat)
```batch
@echo off
REM 배포 패키지 제작 스크립트

set VERSION=1.0
set PACKAGE_NAME=Account_Automation_v%VERSION%
set PACKAGE_DIR=package_temp

echo ========================================
echo 배포 패키지 제작 중...
echo ========================================

REM 임시 디렉토리 생성
if exist %PACKAGE_DIR% rmdir /s /q %PACKAGE_DIR%
mkdir %PACKAGE_DIR%

REM 필요한 파일 복사
echo 파일 복사 중...

copy main.py %PACKAGE_DIR%\
copy requirements.txt %PACKAGE_DIR%\
copy config.example.json %PACKAGE_DIR%\
copy install_production.bat %PACKAGE_DIR%\
copy start_prod.bat %PACKAGE_DIR%\
copy stop.bat %PACKAGE_DIR%\
copy README.txt %PACKAGE_DIR%\

REM 소스 코드 복사
xcopy src %PACKAGE_DIR%\src\ /E /I /Q

REM 데이터 디렉토리
mkdir %PACKAGE_DIR%\data
copy data\holidays.json %PACKAGE_DIR%\data\

REM 문서 복사
mkdir %PACKAGE_DIR%\docs
copy docs\*.pdf %PACKAGE_DIR%\docs\

REM 압축
echo 압축 중...
powershell -Command "Compress-Archive -Path %PACKAGE_DIR%\* -DestinationPath %PACKAGE_NAME%.zip -Force"

REM 정리
rmdir /s /q %PACKAGE_DIR%

echo.
echo ========================================
echo 패키지 제작 완료!
echo ========================================
echo.
echo 파일: %PACKAGE_NAME%.zip
echo.
pause
```

---

## 🧪 테스트 절차 (1일)

### Day 1 - 테스트 PC

#### 오전 (09:00 - 12:00)
```
✅ 1. 환경 설정 (30분)
   - Python 설치 확인
   - 프로젝트 다운로드
   - install.bat 실행
   - config.json 설정 (mode: test)

✅ 2. 테스트 데이터 생성 (30분)
   - create_test_data.py 실행
   - 2024-12-01 데이터 1건 복사
   - data/test_record.json 확인

✅ 3. 로그인 테스트 (30분)
   - start_test.bat 실행
   - 브라우저 화면으로 로그인 확인
   - 세션 저장 확인
   - 로그 확인

✅ 4. 데이터 추출 테스트 (1시간)
   - 필터 적용 확인
   - 테이블 데이터 읽기 확인
   - 1건만 추출되는지 확인
   - 로그 확인
```

#### 오후 (13:00 - 18:00)
```
✅ 5. 데이터 변환 테스트 (30분)
   - 입금보고서 형식 변환 확인
   - TSV 형식 확인
   - 클립보드 복사 확인

✅ 6. 업로드 테스트 (1시간)
   - 입금보고서 페이지 이동 확인
   - 웹자료올리기 팝업 확인
   - 데이터 붙여넣기 확인
   - **F8 저장 (1건만!)** ← 실제 저장
   - 이카운트에서 데이터 확인

✅ 7. 에러 처리 테스트 (1시간)
   - 인터넷 연결 끊기 → 재시도 확인
   - 브라우저 강제 종료 → 재시작 확인
   - 잘못된 데이터 입력 → 스킵 확인

✅ 8. 스케줄러 테스트 (1시간)
   - 30분 간격 실행 확인
   - 시간대 필터 확인
   - 중지/재개 확인

✅ 9. 이메일 알림 테스트 (30분)
   - 테스트 완료 이메일 확인
   - 에러 이메일 발송 확인

✅ 10. 최종 확인 (30분)
   - 로그 파일 검토
   - 리포트 파일 확인
   - 모든 기능 체크리스트 확인
```

### 테스트 완료 기준
```
✅ 로그인 성공
✅ 1건 데이터 추출 성공
✅ 데이터 변환 정확
✅ 클립보드 복사 성공
✅ 업로드 화면 도달
✅ F8 저장 성공 (1건)
✅ 이카운트에서 데이터 확인
✅ 에러 재시도 동작
✅ 이메일 알림 수신
✅ 로그 파일 정상
```

---

## 🚀 배포 절차 (Day 2)

### 배포 준비
```
1. 배포 패키지 제작
   - create_package.bat 실행
   - Account_Automation_v1.0.zip 생성
   - 파일 무결성 확인

2. 패키지 전달
   - USB에 복사 또는
   - 네트워크 드라이브 복사 또는
   - 이메일 첨부 (크기 확인)
```

### 실제 PC 설치 (30분)
```
1. 압축 해제
   - C:\Account_Automation에 압축 해제

2. 설치
   - install_production.bat 실행
   - Python 설치 (없으면)
   - 의존성 설치
   - Playwright 설치

3. 설정
   - config.json 열기
   - 비밀번호 입력
   - Gmail 설정 입력
   - 저장

4. 자동 시작 설정
   - Windows 시작 프로그램 등록
   - 확인: shell:startup
```

### 첫 실행 (10분)
```
1. 수동 실행 테스트
   - start_prod.bat 실행
   - control\status.json 확인
   - 에러 없는지 확인

2. 백그라운드 실행 확인
   - 작업 관리자에서 python.exe 확인
   - 화면 안 보이는지 확인

3. 이메일 확인
   - 시작 알림 수신 확인
```

### 첫 날 모니터링
```
시간대별 확인:
- 06:30: 첫 실행 확인
- 09:00: 오전 실행 확인
- 12:00: 점심 시간 확인
- 15:00: 오후 실행 확인
- 18:00: 마지막 실행 + 일일 리포트 확인

확인 항목:
✅ 이메일 리포트 정상 수신
✅ 에러 없음
✅ 처리 건수 정상
✅ 이카운트에서 데이터 확인 (샘플)
```

---

## 📧 이메일 알림 템플릿

### 테스트 완료 알림
```
제목: [Account Automation] 테스트 완료 - YYYYMMDD

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 테스트 완료 알림
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

테스트 PC에서 모든 테스트가 완료되었습니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
테스트 결과
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✓ 로그인: 성공
✓ 데이터 추출: 1건 성공
✓ 데이터 변환: 정상
✓ 업로드: 성공
✓ F8 저장: 성공 (1건)
✓ 에러 처리: 정상
✓ 이메일 알림: 정상

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
이카운트 확인 필요
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
업로드된 테스트 데이터 1건을 이카운트에서
확인해주세요. 정상적으로 저장되었는지
검증이 필요합니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
다음 단계
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
테스트 통과!
→ 실제 PC에 배포 진행 가능

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
첨부 파일
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- 테스트 로그: automation_YYYYMMDD.log
- 스크린샷: test_screenshots.zip
```

### 배포 완료 알림
```
제목: [Account Automation] 실제 PC 배포 완료

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 배포 완료 알림
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

실제 PC에 Account Automation이
성공적으로 배포되었습니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
배포 정보
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
PC: 실제 운영 PC
버전: v1.0
설치 시간: YYYY-MM-DD HH:MM
실행 모드: Production (완전 자동화)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
운영 스케줄
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
월~금: 06:00 ~ 18:00 (30분마다)
토요일: 06:00 ~ 14:00 (30분마다)
일요일: 실행 안 함
공휴일: 자동 제외

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
다음 실행
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
예정 시간: 내일 06:00
또는 PC 부팅 시 자동 시작

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
모니터링
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- 일일 리포트: 매일 18:00 발송
- 에러 발생 시: 즉시 알림
- 상태 확인: control\status.json

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
중지 방법
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
stop.bat 실행 또는
control\SHUTDOWN.txt 파일 생성
```

---

## 🔧 main.py 핵심 로직

### 모드 구분 로직
```python
import sys
import json

def load_config():
    """설정 로드"""
    with open('config.json', 'r', encoding='utf-8') as f:
        config = json.load(f)
    return config

def main():
    # 명령줄 인자 확인
    args = sys.argv
    mode_from_args = None
    
    for arg in args:
        if arg == '--mode':
            idx = args.index(arg)
            if idx + 1 < len(args):
                mode_from_args = args[idx + 1]
    
    # 설정 로드
    config = load_config()
    mode_from_config = config.get('mode', 'test')
    
    # 모드 결정 (명령줄 우선)
    mode = mode_from_args or mode_from_config
    
    print(f"실행 모드: {mode}")
    
    if mode == 'test':
        run_test_mode(config)
    elif mode == 'production':
        run_production_mode(config)
    else:
        print(f"[오류] 알 수 없는 모드: {mode}")
        sys.exit(1)

def run_test_mode(config):
    """테스트 모드 실행"""
    print("=" * 50)
    print("  테스트 모드")
    print("=" * 50)
    
    # 테스트 설정 적용
    browser_config = {
        'headless': False,  # 화면 보임
        'slow_mo': 500,     # 느리게 실행
    }
    
    # 테스트 데이터 로드
    if config['test_settings']['use_test_data']:
        print("테스트 데이터 사용")
        test_data = load_test_data()
        max_records = config['test_settings']['max_test_records']
        test_data = test_data[:max_records]
        print(f"테스트 레코드 수: {len(test_data)}")
    
    # 실행
    try:
        # 로그인
        login(config['credentials'], browser_config)
        
        # 데이터 추출 (테스트 데이터 사용)
        if config['test_settings']['use_test_data']:
            data = test_data
        else:
            data = extract_data()
        
        # 데이터 변환
        converted = transform_data(data)
        
        # 클립보드 복사
        copy_to_clipboard(converted)
        
        # 업로드
        upload_data()
        
        # F8 저장 (테스트 모드에서는 1개만)
        if config['test_settings']['single_record_save_test']:
            print("F8 저장 테스트 (1건만)")
            press_f8()
            print("저장 완료! 이카운트에서 확인하세요.")
        
        print("테스트 완료!")
        send_test_complete_email(config)
        
    except Exception as e:
        print(f"테스트 실패: {e}")
        send_error_email(config, e)
        raise

def run_production_mode(config):
    """실제 모드 실행"""
    print("=" * 50)
    print("  실제 모드 (Production)")
    print("=" * 50)
    
    # 실제 설정 적용
    browser_config = {
        'headless': True,   # 백그라운드
        'slow_mo': 0,       # 빠르게
    }
    
    # 스케줄러로 실행
    if config['schedule']['enabled']:
        run_scheduler(config, browser_config)
    else:
        # 1회만 실행
        run_once(config, browser_config)

def load_test_data():
    """테스트 데이터 로드"""
    with open('data/test_record.json', 'r', encoding='utf-8') as f:
        test_record = json.load(f)
    return [test_record]  # 리스트로 반환

if __name__ == '__main__':
    main()
```

---

## 📊 체크리스트

### 테스트 PC 체크리스트
```
환경 설정
□ Python 3.8+ 설치
□ 프로젝트 다운로드
□ install.bat 실행
□ config.json mode="test" 확인
□ 가상환경 생성 (선택)

테스트 데이터
□ create_test_data.py 실행
□ 2024-12-01 데이터 1건 복사
□ data/test_record.json 확인

기능 테스트
□ start_test.bat 실행
□ 브라우저 화면 보임
□ 로그인 성공
□ 데이터 추출 (1건)
□ 데이터 변환 정확
□ 클립보드 복사 성공
□ 업로드 화면 도달
□ F8 저장 성공 (1건)
□ 이카운트에서 데이터 확인

에러 처리
□ 네트워크 끊김 → 재시도
□ 브라우저 크래시 → 재시작
□ 잘못된 데이터 → 스킵

알림
□ 테스트 완료 이메일 수신
□ 에러 이메일 수신 (테스트)

로그
□ logs/ 디렉토리 생성
□ 로그 파일 정상
□ 에러 로그 기록

리포트
□ reports/ 디렉토리 생성
□ HTML 리포트 생성
□ 브라우저에서 열림
```

### 실제 PC 체크리스트
```
배포 준비
□ create_package.bat 실행
□ .zip 파일 생성 확인
□ 파일 무결성 확인

전달
□ USB 복사 또는
□ 네트워크 드라이브 또는
□ 이메일 첨부

설치
□ 압축 해제 (C:\Account_Automation)
□ install_production.bat 실행
□ Python 설치 (필요 시)
□ 의존성 설치 완료
□ Playwright 설치 완료

설정
□ config.json 복사 (from config.example.json)
□ mode="production" 확인
□ credentials.password 입력
□ email.sender 입력
□ email.sender_password 입력
□ 설정 파일 저장

자동 시작
□ Windows 시작 프로그램 등록
□ shell:startup에서 확인
□ 바로가기 존재 확인

첫 실행
□ start_prod.bat 실행
□ 백그라운드 실행 확인
□ control\status.json 확인
□ 에러 없음 확인

모니터링
□ 첫 실행 이메일 수신
□ 06:30 실행 확인
□ 09:00 실행 확인
□ 12:00 실행 확인
□ 15:00 실행 확인
□ 18:00 실행 + 리포트 확인
□ 이카운트에서 데이터 샘플 확인
```

---

## 🆘 긴급 대응

### 문제 발생 시
```
1단계: 즉시 중지
   stop.bat 실행
   또는 control\SHUTDOWN.txt 생성

2단계: 로그 확인
   logs\automation_YYYYMMDD.log 열기
   마지막 에러 메시지 확인

3단계: 원인 파악
   - 네트워크 문제?
   - 로그인 실패?
   - 데이터 오류?
   - 브라우저 크래시?

4단계: 조치
   - 일시적 문제: 재시작 (start_prod.bat)
   - 설정 문제: config.json 수정
   - 심각한 문제: 테스트 PC로 가져와서 재테스트

5단계: 확인
   - 정상 작동 확인
   - 이메일 알림 확인
   - 데이터 무결성 확인
```

### 롤백 절차
```
1. 프로그램 중지
   stop.bat

2. 자동 시작 해제
   shell:startup에서 바로가기 삭제

3. 수동 작업으로 전환
   이카운트 수동 업로드

4. 재테스트
   테스트 PC로 가져와서
   문제 원인 파악 및 수정

5. 재배포
   수정 후 재테스트
   → 통과 시 재배포
```

---

## 📝 요약

### 핵심 전략
```
✅ 테스트: 1일 (과거 데이터 1건으로)
✅ 배포: 즉시 완전 자동화
✅ 모드 전환: start_test.bat / start_prod.bat
✅ 안전 장치: 없음 (신속 배포 우선)
✅ 모니터링: 이메일만
✅ 검증: 안 함 (프로그램 신뢰)
```

### 리스크 & 대응
```
⚠️ 리스크: 실제 데이터 처리, 빠른 배포
✅ 대응: 
   - 테스트 시 F8 1건만 저장
   - 첫 날 집중 모니터링
   - 즉시 롤백 준비
   - 긴급 대응 매뉴얼
```

### 다음 단계
```
1. 코딩 시작
2. 테스트 PC에서 1일 테스트
3. 배포 패키지 제작
4. 실제 PC에 배포
5. 첫 날 집중 모니터링
```

---

**설계 완료!** 🎉

이제 코딩을 시작할 준비가 되었습니다.
