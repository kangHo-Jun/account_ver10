# Windows 작업 스케줄러 설정 가이드

## Phase 3: 자동 재시작 설정

매일 05:55에 자동으로 프로그램을 재시작하여 로그 파일 갱신 및 시스템 안정성을 보장합니다.

## 설정 방법

### 1. 작업 스케줄러 열기

```
Win + R → taskschd.msc → Enter
```

또는

```
시작 메뉴 → "작업 스케줄러" 검색
```

### 2. 새 작업 만들기

1. 오른쪽 패널에서 **"작업 만들기..."** 클릭 (기본 작업이 아닌 "작업 만들기")

### 3. 일반 탭 설정

- **이름**: `ERP 자동화 일일 재시작`
- **설명**: `이카운트 ERP 자동화 프로그램을 매일 05:55에 재시작`
- **보안 옵션**:
  - ☑ 사용자의 로그온 여부에 관계없이 실행
  - ☐ 가장 높은 수준의 권한으로 실행
- **구성 대상**: Windows 10

### 4. 트리거 탭 설정

1. **"새로 만들기"** 클릭
2. 설정:
   - **작업 시작**: 일정에 따라
   - **설정**: 매일
   - **시작**: (오늘 날짜) 오전 5:55:00
   - **다음 날짜 이후**: (선택 안 함)
   - **반복 간격**: (선택 안 함)
   - **고급 설정**:
     - ☑ 사용
     - ☐ 작업 기간 제한
3. **확인** 클릭

### 5. 동작 탭 설정

1. **"새로 만들기"** 클릭
2. 설정:
   - **작업**: 프로그램 시작
   - **프로그램/스크립트**:
     ```
     C:\Users\DSAI\Desktop\회계_ERP\restart_daily.bat
     ```
   - **시작 위치** (선택 사항):
     ```
     C:\Users\DSAI\Desktop\회계_ERP
     ```
3. **확인** 클릭

### 6. 조건 탭 설정

- **전원**:
  - ☐ 컴퓨터의 AC 전원이 켜진 경우에만 작업 시작
  - ☐ 컴퓨터가 배터리 전원으로 전환되면 중지
  - ☑ 작업을 실행하기 위해 컴퓨터를 절전 모드에서 해제

### 7. 설정 탭 설정

- ☑ 요청 시 작업을 실행하도록 허용
- ☑ 예약된 시작 시간을 놓친 경우 가능한 빨리 작업 실행
- ☐ 작업이 실패하면 다음 간격으로 다시 시작
- ☐ 작업이 이미 실행 중인 경우 적용할 규칙: 새 인스턴스 시작 안 함

### 8. 저장

- **확인** 클릭
- Windows 사용자 암호 입력 (요청 시)

## 수동 테스트

작업이 제대로 작동하는지 테스트:

1. 작업 스케줄러에서 방금 만든 작업 선택
2. 오른쪽 패널에서 **"실행"** 클릭
3. 로그 파일에서 재시작 확인:
   ```
   logs/v9_YYYYMMDD_055500.log
   ```

## 배치 파일 직접 테스트

커맨드 프롬프트에서:

```batch
cd C:\Users\DSAI\Desktop\회계_ERP
restart_daily.bat
```

예상 출력:
```
[2026-01-14 15:45:00.00] 일일 재시작 시작
[2026-01-14 15:45:00.10] 기존 프로세스 종료 중...
[2026-01-14 15:45:00.50] 프로세스 종료 완료
[2026-01-14 15:45:00.60] 5초 대기 중...
[2026-01-14 15:45:05.70] 락 파일 삭제 완료
[2026-01-14 15:45:05.80] 하트비트 파일 삭제 완료
[2026-01-14 15:45:05.90] 프로그램 재시작 중...
[2026-01-14 15:45:08.00] 재시작 성공
[2026-01-14 15:45:08.10] 일일 재시작 완료
```

## 문제 해결

### 작업이 실행되지 않음

1. 작업 스케줄러에서 작업 선택 → 속성
2. **기록** 탭에서 실행 기록 확인
3. 마지막 실행 결과: `0x0` (성공) 확인

### 프로그램이 재시작되지 않음

1. `restart_daily.bat` 경로 확인
2. Python 경로 확인:
   ```batch
   where pythonw
   ```
3. 수동으로 배치 파일 실행하여 오류 확인

### 권한 문제

- "사용자의 로그온 여부에 관계없이 실행" 선택 시 암호 필요
- 암호가 변경되면 작업 스케줄러에서도 업데이트 필요

## 로그 확인

작업 실행 후 확인:

```batch
# 새 로그 파일 생성 확인
dir logs\v9_*_055*.log

# 최신 로그 내용 확인
type logs\v9_YYYYMMDD_055500.log
```

## 비활성화/삭제

작업 스케줄러에서:
- **비활성화**: 작업 선택 → 오른쪽 클릭 → "사용 안 함"
- **삭제**: 작업 선택 → Delete 키 또는 오른쪽 클릭 → "삭제"
